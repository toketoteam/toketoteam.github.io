---
title: EMR(병원 관리)php 구현
date: 2024-02-10 15:00:00 +0900
categories: [개인 프로젝트, php, html5, MySQL]
tags: [php, html5, MySQL, JavaScript, CSS3]     # TAG names should always be lowercase
comments: true
image:
  path: /assets/img/emr/mainsizeon.png
  alt: EMR 페이지의 메인 화면. 접속하면 오늘 날짜로 자동 설정되어 출력된다. 다른 날짜의 자료를 보고싶으면 우측 하단 달력의 날짜를 클릭한다.
---

## 프로젝트 소개

[**githob 저장소 이동**](https://github.com/toketoteam/EMR)  
> 작업 기간: 2023/08~2023/09

전자의무기록(EMR,Electronic Medical Record)이란, 병원에서 환자 정보와 진료 관리, 진단서 및 보험 등 서식 서류 발급 등 병원 운영에 필요한 필수적인 시스템으로, 개인용 컴퓨터 PC가 보편화된 1990년대 중반 이후 기존의 종이에 기재하는 환자 챠트를 전산화한 것입니다.  
일반적인 ERP(Enterprise Resource Planning) 시스템보다 병원 운영에 특화되어 있습니다.  
수기 차트를 작성했던 시기 이후, 병원은 EMR 전산을 통하여 환자 대기기간 감소, 의료기관의 수기작업을 최소화 및 문서관리 비용절감, 정보저장의 편의성, 환자기록에 대한 의료인의 접근이 용이성 등 여러 이점을 얻을 수 있게 되었습니다.

## 주요 구현 기능

### 0. 시작하기
![](/assets/img/emr/login.png)


시작하기에 앞서 의존성 탭의 프로그램 설치와 DB 설정을 완료하여야 다른 기능들이 정상적으로 동작할 수 있습니다.  
다음 화면에선 'emr login' 테이블에 미리 등록해둔 ID와 Pw를 입력한 후 확인을 눌러야 메인 페이지로 이동합니다.



### 1. 환자 정보 등록
![](/assets/img/emr/pplus.png)
_메인 페이지에서 환자 관리를 클릭시, 환자 등록 정보를 입력하는 새 창 팝업이 나타난다._  

환자의 정보 자체를 등록하는 기능으로, 연동된 Mysql DB에 환자가 등록됩니다.  
환자번호는 INT(7)로 설정하여, 정해진 서식(숫자 7자리)이 아닌 텍스트를 입력할 경우엔 안내 팝업이 발생하며 환자 등록이 되지 않습니다.  
마찬가지로 생년월일 또한 INT(6)의 서식을 가지고 있어, 이를 벗어난 값을 입력하면 등록이 되지 않습니다.  

이곳에서 유효한 정보를 입력하여 환자 등록을 마치면, 이후 여러 다른 기능들에서 DB에 접근하여 다양한 역할을 수행할 수 있게 됩니다.  
입력했던 정보는, 페이지에서 환자를 클릭할 경우 해당 환자의 정보로서 붉은 테두리 박스 내에 표시됩니다.  

### 2. 환자 예약 등록
![](/assets/img/emr/prser.png)
_메인 페이지에서 예약 관리를 클릭시, 환자 등록 정보를 입력하는 새 창 팝업이 나타난다._  

앞서 1번에서 등록했던 환자 정보를 근거로 병원 방문 예약을 등록합니다.  해당 페이지의 주요 부가기능은 다음과 같습니다.  

- 환자 번호 입력 후 엔터 시, 환자 이름, 성별 등 나머지 정보가 텍스트박스에 자동으로 채워짐.  
- 환자 이름으로 검색 시, 동명이인이 환자 번호, 나이, 성별과 함께 모두 표시됨.  

환자 번호는 개인의 고유 번호로, 정확히 알아야 정상적으로 예약이 가능합니다.  만약 올바르지 않은 정보(DB상 존재하지 않는 환자 번호)를 입력할 경우 경고 팝업이 발생하며 예약이 이루어지지 않습니다.  
그러나 직원이 환자 얼굴만 보고 이름과 등록 번호를 전부 알기는 어렵습니다. 또한, 이름은 동명이인이 있을 수 있습니다.  
일반적으로 병원에서 환자가 오면, 정보가 적힌 팔찌의 환자번호를 직접 확인하거나 이름을 물어보고 동명이인 중에서 고르게 됩니다.  

해당 기능을 실무적 관점에서 구현하였으므로 '이름으로 검색' 버튼이 존재합니다. 해당 이름의 환자들 번호와 나이, 성별이 함께 출력되므로, 직원은 이를 토대로 나머지 정보를 물어본 후, 올바른 환자 번호를 추론하여 '환자번호' 칸에 입력하기만 하면 됩니다.  

환자의 번호와 이름 모두가 굳이 표기되는 이유는 실무자가 환자 번호를 잘못 입력하여 등록하는 것을 방지하기 위함입니다. 더블 체크 차원에서 두 가지 모두 확인하면 엉뚱한 환자를 잘못 예약하는 사태를 방지할 수 있습니다.    

이후 담당의와 날짜를 지정하여 등록버튼을 누르면 예약이 완료되며, 우측 하단의 달력을 클릭하면 해당 날짜에 예약된 건들이 목록에 순서대로 출력됩니다.


### 3. 메인 기능
![](/assets/img/emr/mainperf.png)
_크게 빨간 사각 테두리 1~4번으로 기능이 나뉜다._  

(1) 처음 접속 시 오늘 날짜의 예약목록이 자동으로 Wait List에 출력된 상태이며, 마우스 왼쪽으로 다른 날짜를 클릭 시 해당 날짜의 예약 목록이 출력된다.  
(2) 출력된 목록을 좌클릭하면 Patient Info(3번 구역)에 나타난다.  
(3) 예약 목록에서 고른 환자의 정보가 나타난다. 환자 ID와 외래키로 연결된 환자 정보 테이블의 값을 출력한 것이다. 해당 빈칸을 수정하거나 입력하면 실제 DB값이 변경된다.  
(4) '방문 시각' 구역 위치에 마우스 우클릭을 하면 3가지 동작이 가능하다.  
-방문확인: 환자가 내원했을 경우를 상정한다. 현재 시각을 timestamp로 입력하여 표기하게된다. 또한 상태가 다음처럼 '방문'으로 변경된다.  
![](/assets/img/emr/mainperf2.png)  

-예약취소: 정말로 예약을 취소하겠습니까? 라는 팝업이 생성되며, 확인을 누르면 해당 예약 건의 DB가 삭제되어 Wait List에서 사라진다.
-시간변경: 다음 이미지와 같은 팝업이 생성되며, 현재 예약 시간을 다른 시간으로 변경할 수 있다. 확인을 누르면 변경된 시간으로 예약 건이 다시 출력된다. 만약 제시한 서식이 아니면 올바른 서식으로 입력해달라는 팝업과 함께 예약시간 변경이 이루어지지 않고 변경 시도가 취소된다.  
![](/assets/img/emr/timeedit.png)  


## DB 설계 특징
![](/assets/img/emr/s001.png) 
![](/assets/img/emr/s002.png) 
![](/assets/img/emr/s003.png) 


## 사용기술
![](/assets/img/emr/emrgigi.png)  
![](/assets/img/emr/emrgigi2.png)  

개발환경:  
-운영체제 Windows 11 x64bit  
-개발버전은 이하 의존성 설치 참조  

## 의존성 설치


### (1) Apache
(개발버전: 2.4.57-VS17) - https://www.apachelounge.com/download/  
-Apache24\conf\httpd.conf에서 Define SRVROOT 옆의 코드를 올바른 설치경로로 변경 필요  
-시스템 환경변수에 설치경로\bin 까지의 등록 필요  
-깃허브 저장소의 코드 파일은 htdocs폴더 내에 설치  

### (2) php
(개발버전: VC15 x64 Thread safe(2019-Jan-10 00:54:40)) - http://windows.php.net/download  
-php.ini-production을 php.ini로 이름 변경 후 extension_dir 옆의 코드를 "설치경로\ext"로 입력하여 저장  
-php.ini의 ;https://php.net/date.timezone 항목 밑에 ;date.timezone = Asia/Seoul 입력 후 저장(사용환경 위치가 한국이 아닌경우 Asia/Seoul을 해당 타임존 위치로 변경하여 저장)  

### (3) Mysql
(개발버전: 8.0.34) - https://dev.mysql.com/downloads/installer/  
 db host="localhost"  
 db user="root"  
 db password=qwer  
 
 -user명과 password에 차이가 있을 경우, 각 php파일 상단 코드 수정 필요  
 -schema 덤프 파일(Dump20240206.sql파일)을 import하거나, 쿼리문.txt의 쿼리문을 활용하여 직접 DB환경을 구축필요(깃허브 저장소 참조)
 
 
## 프로젝트 후기
유명한 대형 병원의 emr과 중소병원의 emr을 모두 사용해 본 경험에 의하면, 실력이 좋은 병원임에도 의외로 시스템이 비효율적인 부분이 있곤했다.  
예를들어 모 병원은 규모가 커서 간호사, 의사 외에도 원무과 직원이 따로 DB에 접근하여 수정, 등록 권한을 가지고 있었다.  
그러나 같은 정보를 입력했음에도 테이블이 구분되고 trigger로직도 없어서 데이터값이 자동으로 통일되지 않았다. 환자 정보 변경을 하나라도 하면 사내 메신저로 일일이 원무과에 연락을 해서 양쪽 데이터를 수정해야했다.  
미처 등록되지 못한 환자가 내원하면 권한이 없어서 컴퓨터로 아무런 작업도 할 수 없었고, 업무가 밀렸다.  
원무과의 업무 미스가 간호사, 의사의 업무에까지 차질을 빚게 되는 것이었다.  

직접 emr시스템을 개발해보니, 개발 의도(개발자는 각 직원들이 권한을 사용하여 순차적으로 업무가 진행되는 것을 상정했을 것이다.)와 실무(환자의 정보가 잘못 입력되어 수정이 필요한 경우, 환자 보험구분을 변경해야하는 경우 등)에서의 차이를 느낄 수 있었다.  
그리고 그 차이가 어느정도는 필연적이며, 개발 기획과 실무에는 차이가 있을 수 밖에 없다는 것, 그럼에도 보다 효율적이고 편리한 사용이 가능하도록하기 위해 많은 고민이 필요하다는 것을 알게 되었다.  
